# ELK (open source)


![img.png](../img/2025/elkStack.png)

**Elasticsearch:**
- **ìš©ë„**: ElasticsearchëŠ” ì‹¤ì‹œê°„ ë¶„ì„ì„ ìœ„í•œ ë¶„ì‚° ê²€ìƒ‰ ë° ë¶„ì„ ì—”ì§„ì…ë‹ˆë‹¤.
- **ê¸°ëŠ¥**: ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì•ˆì •ì ìœ¼ë¡œ ì €ì¥í•˜ê³ , ì‹ ì†í•˜ê²Œ ê²€ìƒ‰ ë° ì§‘ê³„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **í™œìš©**: ë¡œê·¸, ì§€í‘œ, íŠ¸ëœì­ì…˜ ë“±ì˜ ë‹¤ì–‘í•œ ìœ í˜•ì˜ ë°ì´í„°ë¥¼ ìƒ‰ì¸í™”í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

**Logstash:**
- **ìš©ë„**: LogstashëŠ” ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ë¡œê·¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³ , ë³€í™˜í•˜ë©°, Elasticsearch ë˜ëŠ” ë‹¤ë¥¸ ì €ì¥ì†Œë¡œ ì „ì†¡í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
- **ê¸°ëŠ¥**: ë‹¤ì–‘í•œ ì…ë ¥ ì†ŒìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ê³ , ê·¸ ë°ì´í„°ë¥¼ í•„í„°ë§, ë³€í™˜, ê°€ê³µí•œ í›„, ëª©ì ì§€ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.
- **í™œìš©**: ë‹¤ì–‘í•œ í˜•ì‹ì˜ ë¡œê·¸ ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬ í‘œì¤€í™”ëœ í˜•íƒœë¡œ Elasticsearchë¡œ ì „ì†¡í•˜ì—¬ ë¶„ì„í•˜ê±°ë‚˜ ì €ì¥í•©ë‹ˆë‹¤.

**Kibana:**
- **ìš©ë„**: KibanaëŠ” Elasticsearchì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì‹œê°í™”í•˜ê³  ëŒ€ì‹œë³´ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì›¹ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.
- **ê¸°ëŠ¥**: Elasticsearchì—ì„œ ê²€ìƒ‰ëœ ë°ì´í„°ë¥¼ ê·¸ë˜í”„, ì°¨íŠ¸, ë§µ ë“± ë‹¤ì–‘í•œ ì‹œê°ì  í˜•íƒœë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **í™œìš©**: ë¡œê·¸ ë°ì´í„°ì˜ ì¶”ì„¸, ì´ë²¤íŠ¸, ê²½ê³  ë“±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.



### [ ë””ë ‰í† ë¦¬ êµ¬ì¡° ]
- ëª©í‘œ : ì¹¨í•´ëŒ€ì‘ ê´€ì œ ì‹œìŠ¤í…œ êµ¬ì„±í•˜ê¸° (+ì‹¤ì‹œê°„, +ML)

```
docker
â”œâ”€â”€ compose.yml
â”œâ”€â”€ logstash
â”‚   â”œâ”€â”€ pipeline
â”‚   â”‚   â”œâ”€â”€ logstash.conf
â”œâ”€â”€ kibana
â”‚   â”œâ”€â”€ config
â”‚   â”‚   â”œâ”€â”€ kibana.yml
```

## 1ï¸âƒ£ Dockerì—ì„œ ELK ì‹¤í–‰

- ğŸ“Œ01. Docker Compose ì„¤ì • (compose.yml)
```
version: "3"
networks:
  elk:
    driver: bridge

services:
  # ğŸŸ¢ Elasticsearch ì„¤ì •
  elasticsearch:
    container_name: elasticsearch
    image: elasticsearch:7.17.16
    ports:
      - "9200:9200"
      - "9300:9300"
    volumes:
      - ./elasticsearch:/usr/share/elasticsearch/data
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=true
      - xpack.security.transport.ssl.enabled=true
      - ELASTIC_USERNAME=elastic
      - ELASTIC_PASSWORD=elastic123!@#
    networks:
      - elk

  # ğŸŸ¡ Logstash ì„¤ì •
  logstash:
    container_name: logstash
    image: docker.elastic.co/logstash/logstash:7.17.16
    ports:
      - "5000:5000"
      - "9600:9600"
    volumes:
      - ./logstash/pipeline/logstash.conf:/usr/share/logstash/pipeline/logstash.conf
    depends_on:
      - elasticsearch
    networks:
      - elk

  # ğŸ”µ Kibana ì„¤ì •
  kibana:
    container_name: kibana
    image: kibana:7.17.16
    ports:
      - "5601:5601"
    volumes:
      - ./kibana/config/kibana.yml:/usr/share/kibana/config/kibana.yml
    depends_on:
      - elasticsearch
    networks:
      - elk
```
- ğŸ“Œ02. Kibana ì„¤ì • (kibana.yml)

```
server.name: kibana
server.host: "0"
elasticsearch.hosts: http://elasticsearch:9200
elasticsearch.username: "elastic"
elasticsearch.password: "elastic123!@#"
```
- ğŸ“Œ 03.Logstash ì„¤ì • (logstash.conf)
```
input {
  tcp {
    port => 5000
    codec => json_lines
  }
}

output {
  elasticsearch {
    hosts => "elasticsearch:9200"
    user => "elastic"
    password => "elastic123!@#"
    index => "logstash-%{+YYYY.MM.dd}"
  }
}
```

- ë„ì»¤ ì»´í¬ì¦ˆ ì‹¤í–‰ 
```angular2html
docker compose up -d
http://localhost:5601ì—ì„œ Kibana ì ‘ì† í™•ì¸
```

## 2ï¸âƒ£ Spring Bootì—ì„œ Logstash ì‚¬ìš©
- ğŸ“Œ Gradle ì˜ì¡´ì„± ì¶”ê°€ (build.gradle)
```
implementation 'net.logstash.logback:logstash-logback-encoder:7.4'
```
- ğŸ“Œ Logstash ì„¤ì • (logback-spring.xml)
```
<appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
    <destination>localhost:5000</destination>
    <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
</appender>

<logger name="INFO_LOG" level="DEBUG">
    <appender-ref ref="LOGSTASH"/>
</logger>
```
- ğŸ“Œ ë¡œê·¸ ê¸°ë¡ ì½”ë“œ ì¶”ê°€
```
// í´ë¼ì´ì–¸íŠ¸ IP ê¹Œì§€ ë”°ì™€ì„œ ë¡œê¹…ì„ ë‚¨ê¹€
@Component
@Order(Ordered.HIGHEST_PRECEDENCE)
public class GlobalRequestLoggingFilter implements Filter {
private static final Logger log = LoggerFactory.getLogger(GlobalRequestLoggingFilter.class);

@Override
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
throws IOException, ServletException {
HttpServletRequest req = (HttpServletRequest) request;
String clientIP = req.getRemoteAddr(); // í´ë¼ì´ì–¸íŠ¸ IP ê°€ì ¸ì˜¤ê¸°
log.info("Request from IP: {} - {} {}", clientIP, req.getMethod(), req.getRequestURI());
chain.doFilter(request, response);
}
        }
```

## 3ï¸âƒ£ Kibanaì—ì„œ ë¡œê·¸ í™•ì¸
1.	Kibana ì ‘ì† â†’ http://localhost:5601
2.	Analytics > Discover ë©”ë‰´ í´ë¦­
3.	Create index pattern â†’ logstash-* ì¶”ê°€
4.	@timestamp ì„ íƒ í›„ ì €ì¥
5.	ë¡œê·¸ í™•ì¸ ğŸš€

```angular2html
âœ… ìš”ì•½
	1.	docker-compose.ymlì„ ì‚¬ìš©í•´ ELK ìŠ¤íƒ ì‹¤í–‰
	2.	logstash.confë¡œ Logstash ì…ë ¥/ì¶œë ¥ ì„¤ì •
	3.	logback-spring.xmlì„ ì„¤ì •í•´ Spring Boot ë¡œê·¸ë¥¼ Logstashë¡œ ì „ì†¡
	4.	Kibanaì—ì„œ logstash-* ì¸ë±ìŠ¤ íŒ¨í„´ì„ ìƒì„±í•´ ë¡œê·¸ í™•ì¸
```
